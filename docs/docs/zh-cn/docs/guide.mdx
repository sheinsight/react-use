# ğŸ§­ ä½¿ç”¨æŒ‡å¼• \{#usage-guide}

`@shined/react-use` æ—¨åœ¨**å¼•å¯¼ä¸€ç§é‡å¡‘ React å¼€å‘çš„æ–°ç¼–ç¨‹èŒƒå¼**ã€‚å®ƒé€šè¿‡æä¾›ä¼—å¤šé«˜è´¨é‡ã€è¯­æ„åŒ–çš„ Hooks æ¥å¸®åŠ©å¼€å‘è€…æé«˜å¼€å‘æ•ˆç‡ã€å…»æˆæ›´å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå‡å°‘å¯¹ `useEffect` å’Œ `useState` ç­‰çš„ç›´æ¥ä¾èµ–ï¼ŒåŒæ—¶æœŸæœ›å¼€å‘è€…èƒ½å¤Ÿé€æ¸é€‚åº”ã€Œ**Hooks ä¼˜å…ˆ**ã€çš„ React å¼€å‘ï¼ˆç¼–ç¨‹ï¼‰èŒƒå¼ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§åœºæ™¯çš„ä½¿ç”¨æŒ‡å¼•ï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ `@shined/react-use`ã€‚

## æ›¿æ¢ useState \{#replace-use-state}

`useState` æ˜¯ React ä¸­ç”¨æ¥ç®¡ç†ç»„ä»¶çŠ¶æ€çš„ Hookï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ª React å¼€å‘è€…éƒ½ä¼šç”¨åˆ°ã€‚

ä½†æ˜¯ä½ç‰ˆæœ¬ React ä¸­çš„ `useState` å¯èƒ½å¯¼è‡´éé¢„æœŸçš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨ React &lt;= 17 æ—¶ï¼Œå½“ç»„ä»¶å¸è½½åï¼Œè°ƒç”¨ `setState` ä¼š**æŠ›å‡ºä»¤äººå›°æƒ‘çš„è­¦å‘Š**ï¼ˆå‚è€ƒ [å®‰å…¨çŠ¶æ€](/docs/optmization/safe-state)ï¼‰ã€‚æ­¤å¤–ï¼ŒReact å†…éƒ¨ä½¿ç”¨æµ…æ¯”è¾ƒæ¥åˆ¤æ–­çŠ¶æ€æ˜¯å¦æ”¹å˜ï¼Œè¿™å¯èƒ½ä¼š**å¯¼è‡´ç»„ä»¶è¿›è¡Œä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œä»è€Œå½±å“æ€§èƒ½**ã€‚

### useSafeState

`useSafeState` è¢«è®¾è®¡ä¸º `useState` çš„ç›´æ¥æ›¿ä»£æ–¹æ¡ˆï¼Œç”¨äºè§„é¿ä½ç‰ˆæœ¬ React ä¸‹çš„è­¦å‘Šé—®é¢˜ï¼Œå¹¶éµå¾ªå®˜æ–¹åšæ³•åœ¨é«˜ç‰ˆæœ¬ React ä¸‹ä¸ `useState` è¡Œä¸ºä¿æŒä¸€è‡´ã€‚

åŒæ—¶å®ƒè¿˜å…·å¤‡å¯é€‰çš„æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§ï¼ˆ`deep` é€‰é¡¹ï¼Œæ·±åº¦æ¯”è¾ƒçŠ¶æ€ï¼Œç¡®è®¤å˜æ›´å†æ›´æ–°ï¼Œé»˜è®¤ `false`ï¼‰ã€‚

æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [å®‰å…¨çŠ¶æ€](/docs/optimization/safe-state) å’Œ [useSafeState](/reference/use-safe-state)ã€‚

```tsx
const [name, setName] = useState('react')

// æ›¿æ¢ä¸º
const [name, setName] = useSafeState('react')
```

```tsx
const [state, setState] = useState({ count: 0 })
setState({ count: 0 }) // è§¦å‘é‡æ–°æ¸²æŸ“
setState({ count: 0 }) // è§¦å‘é‡æ–°æ¸²æŸ“
setState({ count: 0 }) // è§¦å‘é‡æ–°æ¸²æŸ“

// æ›¿æ¢ä¸º
const [state, setState] = useSafeState({ count: 0 }, { deep: true })
setState({ count: 0 }) // ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
setState({ count: 0 }) // ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
setState({ count: 0 }) // ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“

// deep ä¸ºå¯é€‰é¡¹ï¼Œå½“çŠ¶æ€ç®€å•ã€å¯æ§ï¼Œä¸”çŠ¶æ€å€¼çš„åœ°å€é¢‘ç¹å˜åŠ¨ï¼Œä½†å®é™…å€¼æœªæ”¹å˜æ—¶ï¼Œå°†æ˜¾è‘—é™ä½æ¸²æŸ“æ¬¡æ•°
```

### useBoolean

`useBoolean` ç”¨äºç®¡ç†å¸ƒå°”å€¼çŠ¶æ€ï¼Œæä¾›äº†ä¸€ç³»åˆ—è¯­æ„åŒ–çš„æ“ä½œå‡½æ•°ï¼Œä¾‹å¦‚ `toggle`ã€`setTrue`ã€`setFalse` ç­‰ï¼Œåº•å±‚ä½¿ç”¨ `useSafeState` ä»¥ç¡®ä¿çŠ¶æ€å®‰å…¨ã€‚

è¯¦æƒ…å‚è€ƒ [useBoolean](/reference/use-boolean)ã€‚

```tsx
const [bool, actions] = useBoolean(false)

actions.toggle() // true
actions.setTrue() // true
actions.setFalse() // false
```

### useCounter

`useCounter` ç”¨äºç®¡ç† number ç±»å‹çŠ¶æ€ï¼Œæä¾›äº†ä¸€ç³»åˆ—è¯­æ„åŒ–çš„æ“ä½œå‡½æ•°ï¼Œä¾‹å¦‚ `inc`ã€`dec`ã€`set` ç­‰ï¼Œåº•å±‚ä½¿ç”¨ `useSafeState` ä»¥ç¡®ä¿çŠ¶æ€å®‰å…¨ã€‚

è¯¦æƒ…å‚è€ƒ [useCounter](/reference/use-counter)ã€‚

```tsx
const [count, actions] = useCounter(0)

actions.inc() // 1
actions.inc(10) // 11
actions.dec() // 10
actions.set(20) // 20
```

## å‡å°‘ useEffect \{#reduce-use-effect}

`useEffect` æ˜¯ React ä¸­æœ€åŸºç¡€ã€æœ€å¸¸ç”¨çš„ Hook ä¹‹ä¸€ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸æ¨èç›´æ¥ä½¿ç”¨ã€‚å› ä¸ºå®ƒçš„ä½¿ç”¨æ–¹å¼ç›¸å¯¹è¾ƒä¸ºåŸå§‹ï¼Œä¸”å®¹æ˜“å‡ºç°**å‰¯ä½œç”¨éš¾ä»¥æ§åˆ¶ï¼Œæˆ–å‰¯ä½œç”¨ä¸é¢„æœŸä¸ç¬¦**ç­‰é—®é¢˜ã€‚

`@shined/react-use` æä¾›äº†ä¸€ç³»åˆ—é«˜è´¨é‡ã€è¯­æ„åŒ–çš„ Hooks æ¥ç­‰ä»·æ›¿æ¢éƒ¨åˆ† `useEffect` è°ƒç”¨åœºæ™¯ã€‚

### useMount

æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨ `useEffect`ï¼ŒåŠŸèƒ½ä¸Šç­‰åŒäºç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ `doSomething()`ã€‚

```tsx
// ä¸æ¨è
useEffect(() => {
  doSomething()
}, [])
```

æˆ–è€…ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œä¸”éœ€è¦æ‹¿åˆ°ç»“æ—¶æœï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåŒ…ä¸€å±‚ async å‡½æ•°æ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œã€‚

```tsx
// ä¸æ¨è
useEffect(() => {
  async function asyncWrapper() {
    const result = await doSomethingAsync()
    const.log(result)
  }

  asyncWrapper()
}, [])
```

ä»¥ä¸Šä»£ç åœ¨é€»è¾‘ä¸Šå®Œå…¨æ²¡é—®é¢˜ï¼Œä½†æ˜¯å­˜åœ¨**ä»£ç å¯è¯»æ€§å·®ã€ç¼ºä¹è¯­æ„åŒ–ã€åæœŸéš¾ä»¥ç»´æŠ¤ã€å¯èƒ½æ„å¤–è¿”å›æ¸…ç†å‡½æ•°**ç­‰è¯¸å¤šé—®é¢˜å’Œéšæ‚£ï¼ŒåŒæ—¶å¯¹å¼‚æ­¥å‡½æ•°æ”¯æŒä¸å¤Ÿå‹å¥½ã€‚æ¨èæ›¿æ¢ä¸ºæ›´åŠ è¯­ä¹‰åŒ–çš„ `useMount`ï¼Œæ”¯æŒå¼‚æ­¥å‡½æ•°ã€‚

è¯¦æƒ…å‚è€ƒ [useMount](/reference/use-mount)ã€‚

```tsx
// æ¨è
useMount(doSomething)

// æ¨è
useMount(async () => {
  const result = await doSomethingAsync()
  const.log(result)
})
```

### useUnmount

`useUnmount` ç”¨äºåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚æ¸…ç†å‰¯ä½œç”¨ï¼ŒåŸºæœ¬ä¸ `useMount` ç±»ä¼¼ï¼Œä½†æ‰§è¡Œæ—¶æœºä¸åŒã€‚

è¯¦æƒ…å‚è€ƒ [useUnmount](/reference/use-unmount)ã€‚

```tsx
// ä¸æ¨è
useEffect(() => {
  return () => {
    doSomething()
  }
}, [])

// æ¨è
useUnmount(doSomething)
```

### useUpdateEffect

`useUpdateEffect` ç”¨äºåœ¨ç»„ä»¶æ›´æ–°æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ç›‘å¬æŸäº›çŠ¶æ€çš„å˜åŒ–å¹¶æ‰§è¡Œæ“ä½œï¼Œä½†æ˜¯**å¿½ç•¥é¦–æ¬¡æ¸²æŸ“**ï¼Œé€‚ç”¨äºä¸éœ€è¦ç«‹å³æ‰§è¡Œå‰¯ä½œç”¨çš„åœºæ™¯ã€‚

è¯¦æƒ…å‚è€ƒ [useUpdateEffect](/reference/use-update-effect)ã€‚

```tsx
// ä¸æ¨è
const isMount = useRef(false)

useEffect(() => {
  if (isMount.current) {
    doSomething()
  } else {
    isMount.current = true
  }
}, [state])
```

```tsx
// æ¨è
useUpdateEffect(() => {
  doSomething()
}, [state])
```

### useEffectOnce

`useEffectOnce` ç”¨äºåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡æ“ä½œï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶ä¹Ÿæ‰§è¡Œä¸€æ¬¡æ“ä½œï¼Œé€‚ç”¨äºåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å‰¯ä½œç”¨çš„åœºæ™¯ï¼Œæœ¬è´¨ä¸Š `useEffectOnce` æ˜¯ `useMount` å’Œ `useUnmount` çš„ç»„åˆã€‚

è¯¦æƒ…å‚è€ƒ [useEffectOnce](/reference/use-effect-once)ã€‚

```tsx
// ä¸æ¨è
useEffect(() => {
  doSomething()
  return () => clearSomething()
}, [])
```

```tsx
// æ¨è
useEffectOnce(() => {
  doSomething()
  return () => clearSomething()
})
```

### useAsyncEffect

`useAsyncEffect` ç”¨äºåœ¨çŠ¶æ€å˜æ›´æ—¶æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œé€‚ç”¨äºéœ€è¦ç›‘å¬çŠ¶æ€å˜åŒ–å¹¶æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„åœºæ™¯ã€‚

è¯¦æƒ…å‚è€ƒ [useAsyncEffect](/reference/use-async-effect)ã€‚

```tsx
// ä¸æ¨è
useEffect(() => {
  async function asyncWrapper() {
    const result = await doSomethingAsync()
    // å½“å‰ Effect æ‰§è¡Œç»“æŸåï¼Œå¯èƒ½ä»ç„¶æ‰§è¡Œåç»­é€»è¾‘ï¼Œå­˜åœ¨å†…å­˜æ³„æ¼ç­‰å®‰å…¨é£é™©
    doSomethingAfter(result)
  }

  asyncWrapper()
}, [state])
```

```tsx
// æ¨è
useAsyncEffect(async (isCancelled) => {
  const result = await doSomethingAsync()
  
  if(isCancelled()) {
    // å¦‚æœå½“å‰ Effect æ‰§è¡Œç»“æŸï¼Œä¸ä¼šæ‰§è¡Œåç»­é€»è¾‘
    clearSomething()
    return
  }

  doSomethingAfter(result)
}, [state])
```

