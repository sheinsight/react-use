---
category: Network
---

# useWebSocket

import { HooksType, Since } from '@/components'

<HooksType {...frontmatter} />

<Since version="v1.7.0" />

A simplified React Hook for using WebSockets, wrapping the native WebSocket API. It supports features such as automatic reconnection and heartbeat.

## Scenes \{#scenes}

- **Persistent Connection Scenarios**: For scenarios that require maintaining a long-term connection with the server, such as instant messaging.
- **Real-time Data Updates**: For pushing updates on stocks, trading, and other real-time data.
- **Real-Time Interactions in Game Development**: Synchronizing player statuses and game progress in multiplayer online games.
- **Heartbeat Checks and Automatic Reconnection**: Ensuring stable connections, automatically dealing with disconnections and reconnections.

## Demo \{#demo}

import { App } from './demo'

<App />

## Usage \{#usage}

```tsx
const ws = useWebSocket(wsUrl, options)

const ws = useWebSocket('wss://echo.websocket.org', {
  // By default, it is false. When configured as true, it uses the default heartbeat configuration.
  // It can also be configured as { interval: 5_000, message: 'ping', responseMessage: 'pong', responseTimeout: 1_000 }
  heartbeat: true, 

  // By default, it is true. It automatically reconnects when disconnected. When configured as false, it does not reconnect.
  // It can also be configured as { count: 3, interval: 1_000 } (default configuration)
  reconnect: true,

  // Filter out the heartbeat messages from the server response
  // filter: (event) => event.data === 'ping',

  // Lifecycle callbacks
  onOpen() {
    console.log('WebSocket connection is open')
  },
  onMessage(message) {
    console.log('Message received', message)
  },
  onError(error) {
    console.error('An error occurred with the WebSocket connection', error)
  },
  onClose(event) {
    console.log('WebSocket connection has closed', event)
  },
})


// ws.readyState // => 0 (CONNECTING), 1 (OPEN), 2 (CLOSING), 3 (CLOSED)

// ws.send(data)
// ws.close()
// ws.open()

// ws.ws() // => A Ref Getter, invokes the function to get a WebSocket instance
```

## Source \{#source}

import { Source } from '@/components'

<Source />

## API \{#api}

```tsx
const ws = useWebSocket(wsUrl, options)

// Or
const ws = useWebSocket(options)
ws.open(wsUrl)
```

### WsUrl Connection String \{#ws-url}

A WebSocket URL string.

### Options \{#options}

```tsx
export type UseWebSocketSendable = string | ArrayBufferLike | Blob | ArrayBufferView

export interface UseWebSocketOptionsHeartbeat {
  /**
   * The heartbeat message sent.
   *
   * @defaultValue 'ping'
   */
  message?: UseWebSocketSendable
  /**
   * Interval for sending heartbeat messages.
   *
   * @defaultValue 1_000
   */
  interval?: number
  /**
   * Server response timeout.
   *
   * @defaultValue 1_000
   */
  responseTimeout?: number
  /**
   * Recognized as a server response to a heartbeat, default is true, meaning any message returned is considered a heartbeat response (regarded as the server being alive).
   * 
   * Can pass in a message string or a function, when the function returns true, it is considered a heartbeat response. It should be used in conjunction with responseTimeout. When timed out, it is considered that the server has disconnected.
   *
   * @defaultValue true
   */
  responseMessage?: true | UseWebSocketSendable | ((data: UseWebSocketSendable) => boolean)
}

export interface UseWebSocketOptionsReconnect
  extends Omit<UseRetryFnOptions, 'onError' | 'onErrorRetry' | 'onRetryFailed'> {
  /**
   * Callback function during reconnection.
   *
   * @defaultValue undefined
   */
  onReconnect?: UseRetryFnOptions['onErrorRetry']
  /**
   * Callback function when reconnection fails.
   *
   * @defaultValue undefined
   */
  onReconnectFailed?: UseRetryFnOptions['onRetryFailed']
}

export interface UseWebSocketOptions {
  /**
   * Callback function when WebSocket's open event is triggered.
   *
   * @defaultValue undefined
   */
  onOpen?: (event: Event, ws: WebSocket) => void
  /**
   * Callback function when WebSocket's close event is triggered.
   *
   * @defaultValue undefined
   */
  onClose?: (event: CloseEvent, ws: WebSocket) => void
  /**
   * Callback function when WebSocket's error event is triggered.
   *
   * @defaultValue undefined
   */
  onError?: (event: Event, ws: WebSocket) => void
  /**
   * Callback function when WebSocket's message event is triggered.
   *
   * @defaultValue undefined
   */
  onMessage?: (event: MessageEvent, ws: WebSocket) => void
  /**
   * Configuration for heartbeats, set to true to use the default configuration, as per UseWebSocketOptionsHeartbeat's default configuration.
   *
   * @defaultValue false
   */
  heartbeat?: boolean | UseWebSocketOptionsHeartbeat
  /**
   * Configuration for reconnections, automatically attempts to reconnect upon disconnection or timeout. Set to true to use the default configuration.
   * 
   * Default configuration: `{ count: 3, interval: 1_000 }`
   *
   * @defaultValue true
   */
  reconnect?: boolean | UseWebSocketOptionsReconnect
  /**
   * Whether to immediately open the WebSocket connection. If a WS URL is provided, the default is true; otherwise, false.
   */
  immediate?: boolean
  /**
   * Whether to close the WebSocket connection when the component unmounts.
   *
   * @defaultValue true
   */
  closeOnUnmount?: boolean
  /**
   * Extra subprotocols for WebSocket.
   *
   * @defaultValue []
   */
  protocols?: string | string[]
  /**
   * Filters the message to the `onMessage` callback, returns `true` to ignore the message.
   *
   * Useful for filtering out heartbeat messages.
   *
   * @defaultValue undefined
   */
  filter?: (event: MessageEvent, ws: WebSocket) => boolean
}
```

### Returns \{#returns}

```tsx
export interface UseWebSocketReturns<HasURL extends boolean> {
  /**
   * A Ref Getter, invoke the function to get a WebSocket instance.
   */
  ws: UseGetterRefReturnsGetter<WebSocket | null>
  /**
   * Sends a message to the server.
   */
  send: (data: UseWebSocketSendable) => void
  /**
   * The current state of the WebSocket.
   */
  readyState: UseWebSocketReturnsReadyState
  /**
   * Closes the WebSocket connection.
   */
  close: () => void
  /**
   * Opens the WebSocket connection. If an old connection exists, it will close it first.
   */
  open: HasURL extends true ? () => void : (wsUrl?: string, protocols?: string | string[]) => void
}

export type UseWebSocketReturnsReadyState =
  | typeof WebSocket.CONNECTING
  | typeof WebSocket.OPEN
  | typeof WebSocket.CLOSING
  | typeof WebSocket.CLOSED
```
